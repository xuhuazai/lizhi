<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极简文字播放器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: sans-serif;
        }
        html, body {
            height: 100%;
            background: #fff;
            padding: 20px;
        }
        .player {
            max-width: 400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .song-title {
            font-size: 18px;
            color: #333;
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .progress {
            width: 100%;
            margin-bottom: 10px;
        }
        .progress-bar {
            width: 100%;
            height: 2px;
            background: #eee;
            position: relative;
            cursor: pointer;
        }
        .progress-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: #000;
            width: 0%;
        }
        .time {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #999;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 20px 0;
            font-size: 16px;
        }
        .control-btn {
            border: none;
            background: none;
            color: #333;
            cursor: pointer;
            padding: 5px 10px;
        }
        .play-btn {
            font-weight: 600;
            font-size: 18px;
        }
        /* 新增：搜索框样式 */
        .search-box {
            margin-bottom: 15px;
            position: relative;
        }
        .search-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #eee;
            border-radius: 4px;
            font-size: 14px;
            outline: none;
        }
        .search-input:focus {
            border-color: #999;
        }
        .playlist {
            flex: 1;
            overflow-y: auto;
            margin-top: 5px;
        }
        .song-item {
            padding: 8px 0;
            font-size: 14px;
            color: #666;
            cursor: pointer;
            border-bottom: 1px solid #f5f5f5;
        }
        .song-item.active {
            color: #000;
            font-weight: 500;
        }
        /* 新增：无结果提示样式 */
        .no-result {
            padding: 10px 0;
            font-size: 14px;
            color: #999;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="player">
        <div class="song-title" id="songTitle">未播放歌曲</div>

        <div class="progress">
            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="time">
                <span id="currentTime">00:00</span>
                <span id="totalTime">00:00</span>
            </div>
        </div>

        <div class="controls">
            <button class="control-btn" id="prevBtn">上一首</button>
            <button class="control-btn play-btn" id="playBtn">播放</button>
            <button class="control-btn" id="nextBtn">下一首</button>
        </div>

        <!-- 新增：搜索框 -->
        <div class="search-box">
            <input type="text" class="search-input" id="searchInput" placeholder="搜索歌曲...">
        </div>

        <div class="playlist" id="playlist">
            <div class="song-item">加载中...</div>
        </div>
    </div>

    <script>
        const audio = new Audio();
        const playBtn = document.getElementById('playBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const currentTimeEl = document.getElementById('currentTime');
        const totalTimeEl = document.getElementById('totalTime');
        const songTitleEl = document.getElementById('songTitle');
        const playlistEl = document.getElementById('playlist');
        const searchInput = document.getElementById('searchInput'); // 新增：搜索输入框

        let songList = []; // 原始歌曲列表
        let filteredList = []; // 过滤后的歌曲列表
        let currentIndex = 0;
        let isPlaying = false;

        async function loadSongs() {
            try {
                const res = await fetch('https://cdn.jsdelivr.net/gh/nj-lizhi/song/audio/download.txt');
                if (!res.ok) throw new Error('加载失败');
                
                const text = await res.text();
                songList = text.split('\n')
                    .filter(line => line.trim() && (line.endsWith('.mp3') || line.endsWith('.flac')))
                    .map(url => {
                        const fileName = url.split('/').pop();
                        const title = fileName.substring(0, fileName.lastIndexOf('.'));
                        return { title, url };
                    });

                filteredList = [...songList]; // 初始化过滤列表为全部歌曲
                renderPlaylist();
                initSearch(); // 初始化搜索功能
            } catch (err) {
                playlistEl.innerHTML = `<div class="song-item">${err.message}</div>`;
            }
        }

        // 渲染歌曲列表（基于过滤后的列表）
        function renderPlaylist() {
            playlistEl.innerHTML = '';
            
            if (filteredList.length === 0) {
                // 新增：无搜索结果提示
                const noResult = document.createElement('div');
                noResult.className = 'no-result';
                noResult.textContent = '未找到匹配歌曲';
                playlistEl.appendChild(noResult);
                return;
            }

            filteredList.forEach((song, index) => {
                // 计算歌曲在原始列表中的索引（用于保持选中状态一致）
                const originalIndex = songList.findIndex(item => item.url === song.url);
                const item = document.createElement('div');
                item.className = `song-item ${originalIndex === currentIndex ? 'active' : ''}`;
                item.textContent = song.title;
                item.onclick = () => {
                    currentIndex = originalIndex; // 用原始索引更新当前播放索引
                    isPlaying = true;
                    playSong();
                };
                playlistEl.appendChild(item);
            });
        }

        // 新增：初始化搜索功能
        function initSearch() {
            searchInput.addEventListener('input', (e) => {
                const keyword = e.target.value.trim().toLowerCase();
                // 过滤歌曲：不区分大小写，包含关键词即匹配
                filteredList = songList.filter(song => 
                    song.title.toLowerCase().includes(keyword)
                );
                renderPlaylist(); // 重新渲染过滤后的列表
            });
        }

        function playSong() {
            if (!songList.length) return;
            
            const song = songList[currentIndex];
            audio.pause();
            audio.src = song.url;
            songTitleEl.textContent = song.title;
            
            // 更新列表选中状态（同时更新原始列表和过滤列表的选中样式）
            document.querySelectorAll('.song-item').forEach((item, i) => {
                const originalIndex = songList.findIndex(item => item.url === filteredList[i].url);
                item.classList.remove('active');
                if (originalIndex === currentIndex) item.classList.add('active');
            });

            audio.onloadedmetadata = () => {
                audio.play().then(() => {
                    playBtn.textContent = '暂停';
                }).catch(() => {
                    isPlaying = false;
                    playBtn.textContent = '播放';
                });
            };
            
            playBtn.textContent = isPlaying ? '暂停' : '播放';
        }

        playBtn.onclick = () => {
            if (!songList.length) {
                loadSongs().then(() => {
                    if (songList.length) {
                        isPlaying = true;
                        playSong();
                    }
                });
                return;
            }

            if (isPlaying) {
                audio.pause();
                playBtn.textContent = '播放';
            } else {
                audio.play();
                playBtn.textContent = '暂停';
            }
            isPlaying = !isPlaying;
        };

        prevBtn.onclick = () => {
            if (!songList.length) return;
            currentIndex = (currentIndex - 1 + songList.length) % songList.length;
            isPlaying = true;
            playSong();
            // 搜索状态下，滚动到当前播放歌曲
            scrollToActiveSong();
        };

        nextBtn.onclick = () => {
            if (!songList.length) return;
            currentIndex = (currentIndex + 1) % songList.length;
            isPlaying = true;
            playSong();
            scrollToActiveSong();
        };

        // 新增：滚动到当前活跃歌曲（搜索时优化体验）
        function scrollToActiveSong() {
            const activeItem = document.querySelector('.song-item.active');
            if (activeItem) {
                activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        audio.ontimeupdate = () => {
            if (isNaN(audio.duration)) return;
            const progress = (audio.currentTime / audio.duration) * 100;
            progressFill.style.width = `${progress}%`;
            currentTimeEl.textContent = formatTime(audio.currentTime);
            totalTimeEl.textContent = formatTime(audio.duration);
        };

        progressBar.onclick = (e) => {
            if (isNaN(audio.duration)) return;
            const pos = (e.clientX - progressBar.getBoundingClientRect().left) / progressBar.offsetWidth;
            audio.currentTime = pos * audio.duration;
        };

        function formatTime(sec) {
            const m = Math.floor(sec / 60).toString().padStart(2, '0');
            const s = Math.floor(sec % 60).toString().padStart(2, '0');
            return `${m}:${s}`;
        }

        audio.onended = () => nextBtn.click();

        // 初始化加载歌曲列表
        loadSongs();
    </script>
</body>
</html>
